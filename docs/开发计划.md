# 后续优化开发计划（建议）

本文档目标：给出可落地的迭代路线，确保每一步都有可验证的交付物与回归手段。

## 总体里程碑（建议）

### M1：可用的个人端工作台（强化录入与检索）

交付：

- 问题编辑（新增/编辑/软删除）（已完成）
- 标签管理与筛选（已完成）
- 附件上传/外部打开/应用内预览（图片/文本类）（已完成）
- 检索体验增强：分页（已完成）、关键词高亮与字段权重评分（已完成）
- 职业/角色模式：设置职业并在编辑页提供模板与固定字段（已完成）
- 职业固定字段可配置：设置 → 职业设置 中按职业勾选默认固定字段（最多 8 个）（已完成）
- 数据清理（危险）：设置 → 操作密码 + 批量删除问题（物理删除，需密码校验）（已完成）
- 主界面职业筛选与总条数展示（已完成）

验收：

- 单测覆盖：Upsert/Delete/FTS/导入导出回归
- 典型数据量（例如 1 万条问题）下可用性评估

### M2：离线导入导出“可交接”

交付：

- 冲突处理 UI：人工选择覆盖/保留（已完成；展示可读摘要与差异提示）
- 导入报告 UI：导入完成提示以“问题条数”为主；日志保留实体分项统计（已完成）；待做：更完整的错误列表/可下载报告
- 增量水位 UI：选择对端、查看上次导入/导出水位与包 ID（待做）

验收：

- 个人↔总库 双向交换流程可重复演示并输出报告

### M3：安全与发布

交付：

- 包加密/验签（可配置、可禁用）
- MSIX 或安装器
- 发布物结构与升级策略文档

验收：

- 在“离线且不可信介质”场景下的风险可控（加密/验签生效）

## 技术债与重点优化（按收益排序）

### 1) 数据模型与一致性

- 用强类型枚举替换 int（Severity/Status）并统一映射策略
- 为增量边界引入更强水位（例如 `(updatedAtUtc, updatedByInstanceId, id)` 组合水位）
- 为实体增加最小字段校验（标题必填、JSON 合法性）

### 2) 导入导出稳定性

- JSONL 流式导入导出：避免一次性读取全部实体
- 更细的错误分类与可恢复策略（跳过坏行但保留报告）
- 附件缺失策略：允许“缺附件导入”，并在报告中提示

### 3) 性能与体验

- 搜索结果直接返回标题/摘要，减少 N+1 次按 ID 读取
- FTS5/评分：权重调优（title 权重更高）、更好的 snippet（多字段选择）、关键词高亮
- UI：分页/虚拟化、导入导出进度与可取消
- 冲突中心：逐字段差异高亮、支持按标题/时间筛选冲突
- 下拉框/表单控件：统一主题模板与可用性（已完成 ComboBox/DatePicker/DataGrid/PasswordBox 主题化；后续可补 ContextMenu 与更多复杂控件）
- 窗口一致性：统一自定义标题栏与窗口行为（拖拽/双击最大化/系统菜单/按钮行为）

### 4) 可维护性

- 引入 Application 层用例服务（而不直接在 UI 调 Store/TransferService）
- 为 SQLite 操作建立统一的参数与读写映射助手
- 为导入导出包建立版本化兼容测试矩阵

## 交付物清单（每个迭代都应更新）

- 文档：数据模型/包格式/数据库迁移说明/用户操作说明
- 测试：新增用例与回归用例
- 变更记录：schemaVersion 与 user_version 的升级说明
