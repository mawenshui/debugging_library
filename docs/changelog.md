# 变更日志 / 版本记录

本文档用于在每次迭代后快速记录“做了什么、影响哪里、需要同步哪些文档”，以降低交接与回归成本。

## 记录规范

- 每次迭代先写 `Unreleased`，发布后将其内容移动到一个明确版本号下
- 每条变更尽量写清楚“用户可感知变化”与“代码入口”
- 涉及数据/包格式/数据库迁移时，必须补充兼容性说明与回归点

## Unreleased

### Added

- 附件应用内预览：支持图片与文本类附件预览，保留“外部打开”。
- 搜索高亮与评分：命中列表标题/摘要支持关键词高亮；按字段权重评分排序。
- 职业/角色模式：设置中可选择 7 类职业；影响问题编辑页的环境字段模板（固定字段 6–8 + 默认自定义字段行）。
- 职业设置：可按职业勾选/新增默认固定字段（最多 8 个），保存后立即影响新建/编辑表单。
- 主界面职业筛选：全部/未标记/7 类职业。
- 分页总数展示：第 N 页（共 M 条）。
- 关于窗口：展示名称、版本、作者、运行时、操作系统。
- 冲突中心可读化：按实体类型展示中文摘要与差异提示。
- 设置：本机操作密码（仅保存 PBKDF2 哈希），用于执行高危操作校验。
- 数据清理（危险）：按职业/标签/更新时间范围筛选后批量物理删除问题（需操作密码）。
- 批量导出：将问题与关联信息批量导出为 Excel/CSV/JSONL，支持按职业/标签/更新时间范围筛选。
- 表单导入：从 Excel（.xlsx）导入问题数据，支持字段映射与校验报告。
- UI：全局滚动条主题化，匹配当前配色与圆角风格。
- UI：DatePicker、DataGrid、PasswordBox 全局主题化，避免默认白底黑字造成风格不一致。
- UI：全局自定义标题栏（拖拽/双击最大化/右键系统菜单/最小化最大化关闭）。
- UI：浅色背景下统一文字渲染策略与像素对齐，减少发虚与锯齿。

### Changed

- 搜索结果排序：有搜索词时优先按评分排序，其次按更新时间倒序。
- 导入完成提示：由“总导入条数”改为“问题条数”，避免误解。
- 应用初始化流程：启动改为异步初始化后再展示主窗口，避免 UI 线程同步等待导致卡死。
- SQLite：启用 WAL 并缩短默认锁等待超时；极端锁冲突会弹窗提示并自动重试一次。
- 产品名称与简介：应用命名更新为“调试资料汇总平台”，主界面与关于页同步展示。
- 关于窗口：默认尺寸与布局优化，内容可完整显示；窗口较小时提供滚动条。
- UI 主题：默认主题切换为浅色玻璃渐变风格，并统一 ListBox/ComboBox 等控件风格。
- 主界面：本机实例ID支持点击复制，并在底部状态栏提示复制结果。

### Fixed

- 导入全量包“导入数大但列表条数不匹配”的误导展示（导入报告拆分计数并修正 UI 文案）。
- 冲突中心 raw JSON 难读（改为摘要/差异提示）。
- 职业设置：点击职业节点偶发卡死（移除 UI 线程同步等待，改为异步初始化与加载）。
- 标签全删后“新建”偶发卡死（SQLite 并发与锁等待导致的无响应，改为 WAL/缩短超时，并在 UI 层自动重试一次与弹窗提示）。
- 附件预览：文本预览控件偶发文字重叠（修正 Visibility 与布局）。
- 下拉框：仅点击右侧箭头才能展开/收起（支持点击整行展开/收起）。
- 批量导出日期输入：手动输入日期时显示不全（DatePickerTextBox 模板优化）。
- 局域网交换窗口：提示信息换行导致下方按钮被撑大（布局拆分并固定按钮高度）。

### Docs

- 更新：当前已实现功能与细节.md、UI原型与操作流.md、数据库设计.md、故障排查.md、安全与隐私.md、开发计划.md、开发指南.md、职业模式与字段模板.md、后续功能优化.md

### Verification

- Build：`dotnet build FieldKb.sln -c Release`
- Test：`dotnet test FieldKb.sln -c Release`

---

## 1.0.3

### Changed

- 控制面板/程序属性信息：发布者显示为“马文水”，版本号更新为 1.0.3。

### Fixed

- 启动偶发无界面/闪退：修复跨线程 UI 更新导致的启动退出，并增加启动窗口保障可见性。

---

## 0.1.0（原型阶段，当前代码基线）

### Added

- 问题录入：新增/编辑/软删除；结构化环境字段 + 自定义扩展字段。
- 标签：标签管理窗口；主界面标签筛选与清空。
- 附件：添加附件并可外部打开。
- 冲突中心：导入冲突可视化对比并人工决议（基础版）。
- 日志：日志窗口（实时追加）与本地文件落盘。
- UI 引导：搜索框说明、关键按钮 ToolTip、输入框水印提示（Tag）。
- UI 主题：Solarized 米黄风格（早期默认主题，后续切换为暗色玻璃主题，再切换为浅色玻璃渐变主题）。
- 搜索体验：关键字包含匹配（多关键字 AND）；未搜索时按更新时间倒序分页（每页 100 条）。
- 主题预览：10 套主题方案预览页（HTML）。

### Changed

- 搜索策略从 FTS5 前缀匹配切换为“包含匹配 + 多关键字 AND”（保留 problem_fts 作为后续可替换增强点）。
- 搜索结果输出契约扩展：增加 Title、UpdatedAtUtc（用于列表直接展示与分页）。
- 自定义环境字段下拉建议项改为中文。

### Docs

- 已同步更新 docs/ 目录相关文档到最新实现（搜索策略、分页、日志、主题等）。
