# 开发指南

## 环境要求

- Windows 10/11
- .NET SDK 8.x
- （可选）Visual Studio 2022 或 Rider

## 解决方案结构

- `FieldKb.sln`
- `src/`：应用代码
- `test/`：测试代码
- `docs/`：项目文档

## 常用命令

- 构建：`dotnet build FieldKb.sln -c Release`
- 测试：`dotnet test FieldKb.sln -c Release`
- 运行：`dotnet run --project src/FieldKb.Client.Wpf/FieldKb.Client.Wpf.csproj`

## 本地数据落盘位置

- 数据目录：`<程序目录>\\data\\`
  - 数据库：`<程序目录>\\data\\kb.sqlite`
  - 附件：`<程序目录>\\data\\attachments\\`
  - 日志：`<程序目录>\\data\\logs\\`
- 配置目录：`<程序目录>\\config\\`
  - 默认配置（随安装包发布）：`<程序目录>\\config\\appsettings.json`
  - 用户配置（运行期写入/升级保留）：`<程序目录>\\config\\appsettings.user.json`
  - 实例标识：`<程序目录>\\config\\instance.json`

## UI 主题与样式

- 全局主题资源：`src/FieldKb.Client.Wpf/Themes/LightTheme.xaml`
- 当前默认风格：浅色玻璃渐变风格（统一控件主题与对比度）
- 下拉框交互：全局 ComboBox 已支持点击整行展开/收起（见 `src/FieldKb.Client.Wpf/Services/ComboBoxBehaviors.cs`）
- 自定义标题栏：全局 Window 模板统一标题栏样式，并提供最小化/最大化/还原/关闭等交互（见 `src/FieldKb.Client.Wpf/ThemedWindow.cs` 与 `src/FieldKb.Client.Wpf/WindowSystemCommands.cs`）
- 最大化不遮挡任务栏：`ThemedWindow` 已对最大化边界做工作区适配，避免底部被任务栏覆盖
- 本机实例ID：主界面支持点击复制本机实例ID，并通过底部状态栏提示复制结果

## 约定与代码规范建议

- Domain 保持纯净：不引入 UI/数据库/IO 依赖
- Application 只放抽象与用例边界，不直接访问磁盘/网络
- Infrastructure 仅实现抽象，不泄露具体实现到 Application
- UI 只依赖 Application 接口并通过 DI 组合

## 贡献流程（建议）

- 需求/缺陷：先补充文档或测试用例，再改实现
- 变更数据库：必须增加迁移并在文档同步更新
- 变更包格式：必须调整 schemaVersion 与兼容策略
